.PHONY: test install start stop clean

# Domy≈õlny model
MODEL ?= qwen2.5:1.5b

test:
	@echo "üß™ Test systemu..."
	@chmod +x test.sh
	@./test.sh

install:
	@echo "üì¶ Instalacja zale≈ºno≈õci..."
	@groovy -e "@Grab('org.apache.camel:camel-core:4.4.0') println 'Camel OK'"
	@groovy -e "@Grab('org.slf4j:slf4j-simple:2.0.9') println 'SLF4J OK'"

start:
	@echo "üöÄ Uruchamianie systemu..."
	@make test
	@groovy email.groovy

start-debug:
	@echo "üêõ Uruchamianie w trybie debug..."
	@groovy -Dgroovy.grape.report.downloads=true \
	        -Djava.util.logging.level=ALL \
	        email.groovy

stop:
	@echo "‚èπÔ∏è Zatrzymywanie..."
	@pkill -f "email.groovy" || true
	@pkill -f "ollama serve" || true

clean:
	@echo "üßπ Czyszczenie..."
	@rm -f *.log
	@rm -f .env.backup

status:
	@echo "üìä Status systemu:"
	@echo -n "Ollama: "
	@curl -s http://localhost:11434/api/tags > /dev/null && echo "‚úÖ UP" || echo "‚ùå DOWN"
	@echo -n "Model $(MODEL): "
	@ollama list | grep -q "$(MODEL)" && echo "‚úÖ READY" || echo "‚ùå NOT_FOUND"

model:
	@echo "üì• Instalacja modelu $(MODEL)..."
	@ollama pull $(MODEL)
	@echo "‚úÖ Model $(MODEL) gotowy"

logs:
	@echo "üìã Ostatnie logi:"
	@tail -20 *.log 2>/dev/null || echo "Brak log√≥w"

help:
	@echo "üîß Dostƒôpne komendy:"
	@echo "make test         - test systemu"
	@echo "make install      - instalacja zale≈ºno≈õci"
	@echo "make start        - uruchomienie systemu"
	@echo "make start-debug  - tryb debug"
	@echo "make stop         - zatrzymanie"
	@echo "make status       - sprawd≈∫ status"
	@echo "make model MODEL=llama3.2:1b - zainstaluj model"
	@echo "make clean        - wyczy≈õƒá pliki tymczasowe"
	@echo "make logs         - poka≈º logi"